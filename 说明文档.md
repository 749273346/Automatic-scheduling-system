# 智能排班系统 V2.0.0 说明文档

## 一、 系统概述
本系统是一款专为电力工区定制的智能排班软件，基于 **"按周循环 + 规则驱动"** 的核心理念，结合现代化 **Apple 风格 UI** 设计，实现了从人员管理到自动排班的全流程智能化。系统摒弃了复杂的权重算法，采用直观的 **"固定+轮班+循环填充"** 策略，确保排班结果公平、透明且易于维护。

## 二、 V2.0.0 核心特性

### 1. 现代化 UI 与交互体验
- **Apple 风格设计**：全面采用圆角卡片、柔和阴影与极简配色，提供流畅的视觉体验。
- **色彩导向操作**：
    - 🔵 **蓝色**：排班规则与常规操作。
    - 🟣 **紫色**：人员管理相关操作。
    - 🟢 **绿色**：Excel 导入/导出等数据交互操作。
- **统一布局**：顶部导航栏整合了视图切换与核心功能入口，操作逻辑高度一致。

### 2. 增强型人员管理
- **卡片式编辑**：新增人员时弹出精美的卡片式对话框，集成添加、编辑、删除功能于一体。
- **Excel 一键交互**：
    - **一键导入**：支持从 Excel 文件批量导入人员信息，自动识别姓名、职位、电话等字段。
    - **自动 ID 生成**：导入时自动按顺序生成 A, B, C... 格式的唯一 ID。
- **列表高级操作**：
    - **多选支持**：支持按住 `Shift` 或 `Ctrl` 进行多选。
    - **右键菜单**：选中人员后可通过右键菜单快速删除。
    - **居中对齐**：列表信息居中显示，清晰易读。

### 3. 灵活的循环排班引擎
- **自定义循环起点**：支持指定 **"循环起始日期"**，系统将以此日期为基准进行循环推演，确保历史排班与未来排班的逻辑连续性。
- **可视化顺序调整**：在循环池配置中，可通过 **"上移/下移"** 按钮直观调整人员的循环优先级。
- **智能状态记忆**：系统自动记录循环池的当前指针位置，跨月/跨年排班时自动衔接，无需人工干预。

## 三、 核心功能详解

### 1. 排班模式 (四大规则)
系统以“周”为模板单位，支持对每天配置不同的排班策略：

| 模式名称 | 英文标识 | 适用场景 | 逻辑描述 |
| :--- | :--- | :--- | :--- |
| **固定人员** | Fixed | 每周固定某天值班 | 指定某人固定在每周几值班（如周二固定为张三）。 |
| **轮班模式** | Rotation | 单双周轮换 | 设定基准日期，单周派 A，双周派 B（如周五轮换）。 |
| **跟随周六** | Follow Sat | 周末连班 | 周日的值班人员自动与周六保持一致。 |
| **循环填充** | Loop | 填补剩余空缺 | 剩余名额从全局“循环池”中按顺序自动提取填充。 |

### 2. 排班操作流程
1.  **配置人员**：在“人员管理”页签导入或添加人员，调整循环池顺序。
2.  **设置规则**：在“排班规则”页签点击对应日期的卡片，配置当天的排班模式。
3.  **生成排班**：
    - **一键本年排班**：自动生成全年的排班表。
    - **一键本月排班**：仅生成当前选择月份的排班。
4.  **导出结果**：点击“导出 Excel”按钮，生成格式规范的排班表文件。

## 四、 技术架构

- **开发语言**：Python 3.x
- **GUI 框架**：PyQt5 (自定义样式表 QSS)
- **数据存储**：
    - **SQLite**：存储人员基础信息与排班历史数据。
    - **JSON**：存储排班规则 (`schedule_rules.json`) 与循环状态 (`schedule_state.json`)。
- **Excel 处理**：openpyxl 库，实现高性能的 Excel 读写。

## 五、 更新日志

### V2.0.0 (2026-01-05)
- **[UI]** 界面全面升级为 Apple 风格，优化按钮配色与布局。
- **[Feature]** 新增 Excel 一键导入功能，支持自动 ID 生成。
- **[Feature]** 增强循环排班逻辑，支持自定义循环起始日期与顺序调整。
- **[Feature]** 人员列表支持多选与右键删除。
- **[Fix]** 修复跨月排班导出数据缺失的问题。
- **[Fix]** 修复本年/本月清除功能失效的问题。

### V1.0.4 (Archive)
- 初始版本发布，包含基础的固定、轮班、循环排班功能。
