# 智能排班系统项目开发计划书 (V2.0 - 灵活版)

## 1. 项目概述
本项目旨在开发一款**灵活的值班排班系统**，支持动态人员配置、个性化偏好设置及智能排班算法。系统基于 Python + PyQt5 开发，采用类 Apple 现代化 UI 风格，核心目标是解决多人值班场景下的排班冲突与公平性问题，支持从简单的固定规则到复杂的人员偏好自动适配。

## 2. 核心功能需求

### 2.1 人员配置模块
- **动态人数管理**：
  - 支持 N ≥ 2 人员配置。
  - 系统自动按 A-Z 字母顺序生成人员标识 (可扩展 AA, AB...)。
- **个性化偏好设置**：
  - **可用日期**：设定允许值班的日期范围。
  - **黑名单 (Blackout Dates)**：设定不可值班的特定日期。
  - **周期偏好**：如每周、隔周值班。
  - **配对偏好**：设定希望或不希望与之搭档的人员。

### 2.2 智能排班引擎
- **排班规则**：
  - **每日定额**：每日安排 2 人值班。
  - **优先级逻辑**：手动排班 > 锁定排班 > 自动排班。
  - **周末特殊处理**：周六、周日必须安排**相同**的 2 人值班 (Weekend Pairing)。
- **可视化交互**：
  - **日历视图**：支持拖拽排班，直观展示每日安排。
  - **实时反馈**：拖拽时实时检测冲突（如黑名单冲突、连班冲突）。
- **自动补全算法**：
  - 基于人员偏好（可用性、配对）自动填充空缺。
  - 算法策略：支持 轮询 (Round Robin)、随机 (Random)、权重 (Weighted) 等模式。

### 2.3 技术实现要求
- **前端 (UI/UX)**：
  - 遵循类 Apple 设计规范：圆角、阴影、简洁配色。
  - 响应式日历组件：适配不同屏幕尺寸，支持拖拽。
- **后端 (Logic/Data)**：
  - **微服务化设计**：排班算法模块独立，便于未来替换或扩展。
  - **规则引擎**：支持基础规则（每日2人）+ 自定义规则（黑名单、周末同人）插拔。
  - **持久化**：使用 SQLite 存储排班历史及人员配置。

## 3. 技术架构方案

### 3.1 开发栈
- **语言**：Python 3.8+
- **GUI**：PyQt5 (支持高 DPI 及 QSS 美化)
- **数据库**：SQLite + SQLAlchemy
- **算法**：Backtracking (回溯法) + Heuristic (启发式)

### 3.2 数据库设计
- **User (人员)**
  - `id`: PK
  - `code`: VARCHAR (A, B, ...)
  - `preferences`: JSON (存储可用性、黑名单、配对偏好等)
  - `color`: VARCHAR (显示颜色)
- **Schedule (排班)**
  - `id`: PK
  - `date`: DATE
  - `user_id`: FK
  - `is_locked`: BOOL
- **Settings (全局配置)**
  - `total_staff`: INT (人员总数)
  - `weekend_mode`: BOOL (是否启用周末同人规则)

## 4. 开发里程碑

### 第1周：需求与架构 (已完成基础版)
- [x] 完成 V1.0 原型。
- [x] 确定 V2.0 需求与技术方案。

### 第2周：核心算法与模型 (已完成)
- [x] **数据模型重构**：支持动态人员及 JSON 偏好存储。
- [x] **算法升级**：实现“周末同人”硬约束及“黑名单”软约束。
- [x] **配置模块**：实现人员数量动态调整的后端逻辑。

### 第3周：可视化与交互 (已完成)
- [x] **设置界面**：开发人员数量调整及偏好设置 UI (含弹窗)。
- [x] **日历优化**：支持自由拖拽，手动操作优先级最高。
- [x] **冲突提示**：算法层已集成冲突检测。

### 第4周：集成与测试 (进行中)
- [x] **系统集成**：联调 UI 与新版算法，支持一键自动排班。
- [x] **自动化测试**：覆盖核心规则（每日2人、周末同人）。
- [x] **文档交付**：用户手册已生成 (`使用手册.md`)。
- [ ] **性能优化**：针对大规模人员配置的算法优化。

## 5. 交付物清单
1. 完整源代码 (含注释)。
2. 可执行程序 (.exe)。
3. 自动化测试脚本。
4. 项目文档 (设计文档、用户手册)。
